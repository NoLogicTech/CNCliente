@using Syncfusion.Blazor
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Data
@using Syncfusion.Blazor.TreeGrid
@using Syncfusion.Blazor.Navigations
@using Syncfusion.Blazor.Inputs
@using Blazor.Models
@inject HttpClient httpclient

@page "/ttarefa"

@{

}

@error123
<div class="flex bg-gray-100 flex-grow flex-col">
    <div class="flex p-4 font-bold text-2xl text-gray-800 border-b-2 mx-3 border-blue-600 border-opacity-90 h-14 ">
        <p>TABELAS</p>
        <p class="px-3"> | </p>
        <p>TAREFAS</p>
    </div>
    <div class="flex bg-white m-3 rounded-sm shadow-lg">
        <div class="flex">
            <SfTreeGrid TValue="Tarefa" IdMapping="tarefaId" AllowPaging="true" AllowSorting="true"
                        ParentIdMapping="tarefaParentid" HasChildMapping="tarefaTemfilho"
                        TreeColumnIndex="1" Toolbar="@(new List<string>() { "Add", "Edit", "Delete", "Update", "Cancel" })">
                <SfDataManager Url="http://localhost:45000/api/Tarefa" Adaptor="Adaptors.WebApiAdaptor" CrossDomain="true"></SfDataManager>
                <TreeGridEditSettings AllowEditing="true"
                                      AllowAdding="true"
                                      AllowDeleting="true"
                                      AllowEditOnDblClick="true"
                                      NewRowPosition="RowPosition.Child"></TreeGridEditSettings>
                <TreeGridColumns>
                    <TreeGridColumn Field="tarefaId" Visible="false" HeaderText="ID" Width="80" IsPrimaryKey="true" IsIdentity="true"></TreeGridColumn>
                    <TreeGridColumn Field="tarefaNome" HeaderText="Designação" Width="320" Type=ColumnType.String></TreeGridColumn>
                    <TreeGridColumn Field="projetoId" Visible="false" DefaultValue=@Projeto HeaderText="Projeto" Width="80"></TreeGridColumn>
                    <TreeGridColumn Field="tarefaParentid" Visible="true" Width="80"></TreeGridColumn>
                    <TreeGridColumn Field="tarefaDatahoraregisto" DefaultValue=@DateTime.Now Visible="false" Width="160" Type="Syncfusion.Blazor.Grids.ColumnType.DateTime" EditType="Syncfusion.Blazor.Grids.EditType.DateTimePickerEdit"></TreeGridColumn>
                    <TreeGridColumn Field="tarefaDatalimite" DefaultValue=@DateTime.Now HeaderText="Data Limite" Format="d" Width="160" Type="Syncfusion.Blazor.Grids.ColumnType.DateTime" EditType="Syncfusion.Blazor.Grids.EditType.DateTimePickerEdit"></TreeGridColumn>
                    <TreeGridColumn Field="tarefaPosicao" Visible="false" HeaderText="" Width="80"></TreeGridColumn>
                    <TreeGridColumn Field="utilizadorIdcriador" DefaultValue=@UtilizadorCriador Visible="false" HeaderText="" Width="80"></TreeGridColumn>
                    <TreeGridColumn Field="utilizadorIdatribuido" DefaultValue=@UtilizadorAtribuido HeaderText="Responsável" Width="80"></TreeGridColumn>
                    <TreeGridColumn Field="tarefaEstado" DefaultValue="false" HeaderText="Estado" DisplayAsCheckBox="true" Width="80"></TreeGridColumn>
                    <TreeGridColumn Field="tarefaTemfilho" Visible="false" HeaderText="" Width="80"></TreeGridColumn>
                </TreeGridColumns>
            </SfTreeGrid>
        </div>
    </div>
</div>

<style>
    .e-grid .e-headercell {
        background-color: rgba(37, 99, 235, 0.9);
        font-weight: bolder;
        color: white;
    }
</style>



@code {
    // VALORES DE INICIALIZAÇÃO SIMULADOS
    public int Projeto { get; set; } = 1;
    public int UtilizadorCriador { get; set; } = 1;
    public int UtilizadorAtribuido { get; set; } = 1;

    public SfTreeGrid<Tarefa> treeGrid { get; set; }

    private List<object> ToolbarItems = new List<object>()
    {
    new ItemModel() {Text = "Novo", PrefixIcon = "e-add", Id = "Grid_add"},
    new ItemModel() {Text = "Editar", PrefixIcon = "e-edit", Id = "Grid_edit"},
    new ItemModel() {Text = "Apagar", PrefixIcon = "e-delete", Id = "Grid_delete"},
    new ItemModel() {Text = "Guardar", PrefixIcon = "e-update", Id = "Grid_update"},
    new ItemModel() {Text = "Cancelar", PrefixIcon = "e-cancel", Id = "Grid_cancel"},
    new ItemModel() {Text = "Excel", PrefixIcon = "e-excelexport", Id = "Grid_excelexport"},
    new ItemModel() {Text = "PDF", PrefixIcon = "e-pdfexport", Id = "Grid_pdfexport"}
    };

    private List<object> ContextMenuItems = new List<object>()
    {
    "Edit",
    "Delete",
    "Copy"
    };

    public string error123;

    public void ActionFailureHandler(Syncfusion.Blazor.Grids.FailureEventArgs args)
    {
        Exception myReturnedException = args.Error;
        error123 = myReturnedException.ToString();
    }



}